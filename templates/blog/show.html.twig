{% extends 'base.html.twig' %}

{% block title %}Blog{% endblock %}

{% block body %}
    <h1 class="text-center my-5">{{ blog.title }}</h1>

    <div class="container">
        <div class="row">
            <div class="col">
                <p class="text-center">{{ blog.content }}</p>
                <p class="ml-4">Billet de blog écrit par <span><i>{{ blog.user.email }}</i> le <i>{{ blog.createAt|date('d-m-Y H:i') }}</i></span></p>
                {% if blog.modifyAt != null %}
                <p class="ml-4">Dernière modification le <span><i>{{ blog.modifyAt|date('d-m-Y H:i') }}</i></span></p>
                {% endif %}

                <div class="text-center my-4">
                    <h3> Un petit commentaire ?</h3>
                    <textarea id="commentTextarea" cols="100" rows="10"></textarea>
                </div>

                <div class="text-center my-4">
                    <button id="test" class="btn btn-primary">Text AJAX</button>
                </div>


                <div class="text-center">
                    <a  href="{{ path('app_blog_index') }}">Retour à l'index</a>
                </div>
            </div>
        </div>
    </div>

{#    <a href="{{ path('app_blog_edit', {'id': blog.id}) }}">edit</a>#}

{#    {{ include('blog/_delete_form.html.twig') }}#}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        // NOTRE AJAX
        var test = document.getElementById('test');


        test.addEventListener('click', function (){

            var textContent = tinymce.get('commentTextarea').getContent();

            fetch("{{ path('app_comment_new') }}", {
                method: "POST",
                headers: {
                    Accept: "application/json",
                },
                body: JSON.stringify({
                    id: {{ blog.id }},
                    content : textContent,
        })
            })
                .then(response => response.json())
                .then(data => console.log(data));
        })

    </script>
{% endblock %}


